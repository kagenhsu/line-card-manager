# è³‡æ–™åº«å¤–éµéŒ¯èª¤ä¿®æ­£èªªæ˜

## ğŸš¨ å•é¡Œæè¿°

æ‚¨é‡åˆ°çš„éŒ¯èª¤æ˜¯ï¼š
```
sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'published_cards.customer_id' could not find table 'customers' with which to generate a foreign key to target column 'id'
```

é€™æ˜¯å› ç‚ºè³‡æ–™æ¨¡å‹çš„åŒ¯å…¥é †åºå•é¡Œï¼Œ`published_cards` è¡¨éœ€è¦åƒç…§ `customers` è¡¨ï¼Œä½† `customers` è¡¨é‚„æ²’æœ‰å»ºç«‹ã€‚

## ğŸ”§ è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¿®æ­£ç‰ˆä¸»ç¨‹å¼ï¼ˆæ¨è–¦ï¼‰

1. **æ›¿æ›ä¸»ç¨‹å¼æª”æ¡ˆ**
   ```bash
   # å‚™ä»½åŸæª”æ¡ˆ
   mv src/main.py src/main_backup.py
   
   # ä½¿ç”¨ä¿®æ­£ç‰ˆ
   mv src/main_fixed.py src/main.py
   ```

2. **é‡æ–°å•Ÿå‹•ç³»çµ±**
   ```bash
   python src/main.py
   ```

### æ–¹æ³•äºŒï¼šæ‰‹å‹•ä¿®æ­£ main.py

é–‹å•Ÿ `src/main.py` æª”æ¡ˆï¼Œå°‡å…§å®¹æ›¿æ›ç‚ºï¼š

```python
from flask import Flask, render_template, request, jsonify, send_from_directory
from flask_sqlalchemy import SQLAlchemy
from flask_cors import CORS
import os
import sys

# æ·»åŠ  src ç›®éŒ„åˆ° Python è·¯å¾‘
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

app = Flask(__name__, static_folder='static', static_url_path='')
CORS(app)

# è³‡æ–™åº«è¨­å®š
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database/app.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.config['SECRET_KEY'] = 'your-secret-key-here'

db = SQLAlchemy(app)

# ç¢ºä¿è³‡æ–™åº«ç›®éŒ„å­˜åœ¨
os.makedirs(os.path.join(os.path.dirname(__file__), 'database'), exist_ok=True)

# åŒ¯å…¥æ¨¡å‹ - æ³¨æ„é †åºå¾ˆé‡è¦ï¼
from models.user import User
from models.customer import Customer
from models.card_template import CardTemplate

# å»ºç«‹åŸºæœ¬è³‡æ–™è¡¨
with app.app_context():
    db.create_all()

# åŒ¯å…¥æœ‰å¤–éµé—œè¯çš„æ¨¡å‹
from models.published_card import PublishedCard

# å†æ¬¡å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨ï¼ˆåŒ…å«å¤–éµé—œè¯ï¼‰
with app.app_context():
    db.create_all()

# åŒ¯å…¥è·¯ç”±
from routes.user import user_bp
from routes.customer import customer_bp
from routes.line_service import line_service_bp
from routes.line_config import line_config_bp
from routes.card_publisher import card_publisher_bp
from routes.card_display import card_display_bp

# è¨»å†Šè—åœ–
app.register_blueprint(user_bp, url_prefix='/api')
app.register_blueprint(customer_bp, url_prefix='/api')
app.register_blueprint(line_service_bp, url_prefix='/api')
app.register_blueprint(line_config_bp, url_prefix='/api')
app.register_blueprint(card_publisher_bp, url_prefix='/api')
app.register_blueprint(card_display_bp)

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def serve(path):
    static_folder_path = app.static_folder
    if static_folder_path is None:
        return "Static folder not configured", 404

    if path != "" and os.path.exists(os.path.join(static_folder_path, path)):
        return send_from_directory(static_folder_path, path)
    else:
        index_path = os.path.join(static_folder_path, 'index.html')
        if os.path.exists(index_path):
            return send_from_directory(static_folder_path, 'index.html')
        else:
            return "index.html not found", 404

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
```

### æ–¹æ³•ä¸‰ï¼šåˆªé™¤è³‡æ–™åº«é‡æ–°å»ºç«‹

å¦‚æœä¸Šè¿°æ–¹æ³•ä»æœ‰å•é¡Œï¼Œå¯ä»¥åˆªé™¤ç¾æœ‰è³‡æ–™åº«ï¼š

```bash
# åˆªé™¤è³‡æ–™åº«æª”æ¡ˆ
rm src/database/app.db

# é‡æ–°å•Ÿå‹•ç³»çµ±
python src/main.py
```

## ğŸ” å•é¡ŒåŸå› 

1. **åŒ¯å…¥é †åºå•é¡Œ**ï¼š`published_card.py` ä¸­çš„å¤–éµåƒç…§äº† `customers` è¡¨ï¼Œä½†è©²è¡¨é‚„æ²’æœ‰å»ºç«‹
2. **è³‡æ–™è¡¨å»ºç«‹æ™‚æ©Ÿ**ï¼šæ‰€æœ‰æ¨¡å‹éœ€è¦åœ¨ `db.create_all()` ä¹‹å‰åŒ¯å…¥
3. **å¤–éµä¾è³´**ï¼šæœ‰å¤–éµé—œè¯çš„è¡¨éœ€è¦åœ¨è¢«åƒç…§çš„è¡¨å»ºç«‹å¾Œæ‰èƒ½å»ºç«‹

## âœ… ä¿®æ­£å¾Œçš„æ”¹é€²

1. **åˆ†éšæ®µå»ºç«‹è³‡æ–™è¡¨**ï¼šå…ˆå»ºç«‹åŸºæœ¬è¡¨ï¼Œå†å»ºç«‹æœ‰å¤–éµé—œè¯çš„è¡¨
2. **æ­£ç¢ºçš„åŒ¯å…¥é †åº**ï¼šç¢ºä¿è¢«åƒç…§çš„æ¨¡å‹å…ˆåŒ¯å…¥
3. **è³‡æ–™åº«ç›®éŒ„æª¢æŸ¥**ï¼šç¢ºä¿è³‡æ–™åº«ç›®éŒ„å­˜åœ¨

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

ä¿®æ­£å¾Œè«‹æŒ‰ä»¥ä¸‹æ­¥é©Ÿæ¸¬è©¦ï¼š

1. **å•Ÿå‹•ç³»çµ±**
   ```bash
   python src/main.py
   ```

2. **æª¢æŸ¥å•Ÿå‹•è¨Šæ¯**
   æ‡‰è©²çœ‹åˆ°ï¼š
   ```
   * Running on all addresses (0.0.0.0)
   * Running on http://127.0.0.1:5000
   * Running on http://[your-ip]:5000
   ```

3. **é–‹å•Ÿç€è¦½å™¨**
   è¨ªå• `http://localhost:5000` ç¢ºèªç³»çµ±æ­£å¸¸é‹è¡Œ

4. **æ¸¬è©¦åŠŸèƒ½**
   - æ–°å¢å®¢æˆ¶è³‡æ–™
   - é–‹å•Ÿåç‰‡è¨­è¨ˆå™¨
   - æ¸¬è©¦åç‰‡ä¸Šæ¶åŠŸèƒ½

## ğŸ“ å¦‚æœä»æœ‰å•é¡Œ

å¦‚æœä¿®æ­£å¾Œä»æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š

1. **Pythonç‰ˆæœ¬**ï¼šç¢ºèªä½¿ç”¨ Python 3.8+
2. **å¥—ä»¶ç‰ˆæœ¬**ï¼šç¢ºèª Flask-SQLAlchemy ç‰ˆæœ¬ç›¸å®¹
3. **æª”æ¡ˆæ¬Šé™**ï¼šç¢ºèªæœ‰å¯«å…¥è³‡æ–™åº«ç›®éŒ„çš„æ¬Šé™
4. **è·¯å¾‘å•é¡Œ**ï¼šç¢ºèªåœ¨æ­£ç¢ºçš„ç›®éŒ„ä¸‹åŸ·è¡Œ

---

ä¿®æ­£å¾Œç³»çµ±æ‡‰è©²å¯ä»¥æ­£å¸¸å•Ÿå‹•ä¸¦ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼

