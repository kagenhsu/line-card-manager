# LINE電子名片管理系統 - 故障排除指南

## 🚨 常見啟動問題及解決方案

### 問題1: 資料庫外鍵錯誤
```
sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'published_cards.customer_id' could not find table 'customers'
```

**解決方案：**
1. **使用簡化版主程式**
   ```bash
   # 備份原檔案
   mv src/main.py src/main_backup.py
   # 使用簡化版
   cp src/main_simple.py src/main.py
   ```

2. **或刪除資料庫重建**
   ```bash
   rm src/database/app.db
   python src/main.py
   ```

### 問題2: Python版本過低
```
❌ 錯誤: 需要 Python 3.8 或更高版本
```

**解決方案：**
1. **檢查Python版本**
   ```bash
   python --version
   python3 --version
   ```

2. **安裝新版Python**
   - Windows: 下載 https://www.python.org/downloads/
   - macOS: `brew install python3`
   - Ubuntu: `sudo apt update && sudo apt install python3.8`

### 問題3: 套件安裝失敗
```
❌ 相依套件安裝失敗
```

**解決方案：**
1. **手動安裝套件**
   ```bash
   pip install flask flask-sqlalchemy flask-cors
   ```

2. **使用國內鏡像（中國用戶）**
   ```bash
   pip install -i https://pypi.tuna.tsinghua.edu.cn/simple flask flask-sqlalchemy flask-cors
   ```

3. **升級pip**
   ```bash
   python -m pip install --upgrade pip
   ```

### 問題4: 端口被占用
```
OSError: [Errno 48] Address already in use
```

**解決方案：**
1. **查找占用端口的程式**
   ```bash
   # Windows
   netstat -ano | findstr :5000
   
   # macOS/Linux
   lsof -i :5000
   ```

2. **終止占用程式**
   ```bash
   # Windows
   taskkill /PID <PID號碼> /F
   
   # macOS/Linux
   kill -9 <PID號碼>
   ```

3. **使用不同端口**
   修改 `main.py` 中的端口號：
   ```python
   app.run(host='0.0.0.0', port=5001, debug=False)
   ```

### 問題5: 找不到模組
```
ModuleNotFoundError: No module named 'flask'
```

**解決方案：**
1. **確認在正確的虛擬環境**
   ```bash
   # 啟動虛擬環境
   source venv/bin/activate  # macOS/Linux
   venv\Scripts\activate     # Windows
   ```

2. **重新安裝套件**
   ```bash
   pip install -r requirements.txt
   ```

### 問題6: 權限錯誤
```
PermissionError: [Errno 13] Permission denied
```

**解決方案：**
1. **Windows: 以管理員身份執行**
   - 右鍵點擊 `start.bat`
   - 選擇「以管理員身份執行」

2. **macOS/Linux: 檢查檔案權限**
   ```bash
   chmod +x start.sh
   chmod 755 src/main.py
   ```

### 問題7: 防火牆阻擋
```
無法連接到 http://localhost:5000
```

**解決方案：**
1. **Windows防火牆**
   - 控制台 → 系統及安全性 → Windows Defender 防火牆
   - 允許應用程式通過防火牆
   - 新增Python到允許清單

2. **macOS防火牆**
   - 系統偏好設定 → 安全性與隱私權 → 防火牆
   - 防火牆選項 → 允許Python

## 🔧 快速修復方案

### 方案1: 使用快速啟動腳本
```bash
python quick_start.py
```
這個腳本會自動：
- 檢查Python版本
- 安裝必要套件
- 建立目錄結構
- 啟動簡化版系統

### 方案2: 最小化啟動
如果所有方法都失敗，使用最基本的啟動方式：

1. **建立最簡單的測試檔案** `test_server.py`：
   ```python
   from flask import Flask
   app = Flask(__name__)
   
   @app.route('/')
   def hello():
       return '<h1>系統測試成功！</h1><p>LINE電子名片管理系統正在運行</p>'
   
   if __name__ == '__main__':
       app.run(host='0.0.0.0', port=5000)
   ```

2. **啟動測試**：
   ```bash
   python test_server.py
   ```

3. **開啟瀏覽器**：http://localhost:5000

### 方案3: 使用Docker（進階用戶）
如果本地環境問題太多，可以使用Docker：

1. **建立 Dockerfile**：
   ```dockerfile
   FROM python:3.9-slim
   WORKDIR /app
   COPY requirements.txt .
   RUN pip install -r requirements.txt
   COPY . .
   EXPOSE 5000
   CMD ["python", "src/main_simple.py"]
   ```

2. **建立並執行容器**：
   ```bash
   docker build -t line-card-manager .
   docker run -p 5000:5000 line-card-manager
   ```

## 📋 檢查清單

在尋求幫助前，請確認以下項目：

### ✅ 環境檢查
- [ ] Python版本 ≥ 3.6
- [ ] pip已安裝且可用
- [ ] 網路連線正常
- [ ] 有足夠的磁碟空間（至少100MB）

### ✅ 檔案檢查
- [ ] 所有檔案已正確解壓縮
- [ ] `requirements.txt` 檔案存在
- [ ] `src/` 目錄存在
- [ ] 主程式檔案存在

### ✅ 權限檢查
- [ ] 有寫入目錄的權限
- [ ] 防火牆允許Python程式
- [ ] 端口5000未被占用

### ✅ 套件檢查
- [ ] Flask已安裝
- [ ] Flask-SQLAlchemy已安裝
- [ ] Flask-CORS已安裝

## 🆘 獲取幫助

如果以上方法都無法解決問題，請提供以下資訊：

1. **作業系統**：Windows/macOS/Linux版本
2. **Python版本**：`python --version` 的輸出
3. **錯誤訊息**：完整的錯誤訊息截圖或文字
4. **嘗試過的解決方案**：已經試過哪些方法
5. **系統環境**：是否使用虛擬環境、防毒軟體等

## 💡 預防措施

為避免未來出現問題：

1. **定期更新Python**到最新穩定版本
2. **使用虛擬環境**隔離專案相依性
3. **備份工作目錄**避免資料遺失
4. **關閉不必要的防毒軟體**即時掃描
5. **確保網路穩定**避免下載中斷

---

**記住：大部分問題都可以透過重新安裝套件或使用簡化版主程式解決！**

