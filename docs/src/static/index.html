<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理後台 - LINE電子名片系統</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="common-header.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- 統一頁首導航 -->
    <nav class="main-navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">
                <i class="fas fa-id-card"></i>
                LINE電子名片系統
            </a>
            
            <ul class="navbar-menu" id="navbarMenu">
                <li class="navbar-item">
                    <a href="/" class="navbar-link active">
                        <i class="fas fa-home"></i> 管理後台
                    </a>
                </li>
                <li class="navbar-item">
                    <a href="/flex-card-builder-v2.html" class="navbar-link">
                        <i class="fas fa-paint-brush"></i> 專業設計器
                    </a>
                </li>
                <li class="navbar-item">
                    <a href="/card-gallery.html" class="navbar-link">
                        <i class="fas fa-images"></i> 名片展示廊
                    </a>
                </li>
                <li class="navbar-item">
                    <a href="/card-import.html" class="navbar-link">
                        <i class="fas fa-file-import"></i> 名片匯入
                    </a>
                </li>
            </ul>
            
            <button class="navbar-toggle" id="navbarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- 頁面標題 -->
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-users-cog"></i>
                客戶管理後台
            </h1>
            <p class="page-subtitle">管理客戶資料、發送電子名片、設定LINE Bot功能</p>
        </div>

        <!-- 快速操作區域 -->
        <div class="quick-actions">
            <button class="btn btn-primary" onclick="showAddCustomerModal()">
                <i class="fas fa-user-plus"></i> 新增客戶
            </button>
            <a href="flex-card-builder-v2.html" class="btn btn-success">
                <i class="fas fa-paint-brush"></i> 專業設計器
            </a>
            <a href="card-import.html" class="btn btn-info">
                <i class="fas fa-file-import"></i> 匯入名片
            </a>
            <button class="btn btn-secondary" onclick="showLineConfigModal()">
                <i class="fab fa-line"></i> LINE設定
            </button>
        </div>

        <!-- 主要內容區域 -->
        <main class="main-content">
            <!-- 搜尋區域 -->
            <div class="search-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="搜尋客戶姓名、公司、電話或信箱...">
                </div>
                <div class="filter-actions">
                    <button id="batchSendBtn" class="btn btn-success" disabled>
                        <i class="fas fa-paper-plane"></i> 批量發送 (<span id="selectedCount">0</span>)
                    </button>
                </div>
            </div>

            <!-- 客戶列表 -->
            <div class="customers-section">
                <div class="section-header">
                    <h2>客戶列表</h2>
                    <div class="list-controls">
                        <button id="selectAllBtn" class="btn btn-outline">
                            <i class="fas fa-check-square"></i> 全選
                        </button>
                        <button id="refreshBtn" class="btn btn-outline">
                            <i class="fas fa-sync-alt"></i> 重新整理
                        </button>
                    </div>
                </div>
                
                <div id="customersContainer" class="customers-container">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> 載入中...
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 新增/編輯客戶模態框 -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">新增客戶</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="customerForm" class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">姓名 *</label>
                        <input type="text" id="customerName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">電話</label>
                        <input type="tel" id="customerPhone" name="phone">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerEmail">電子郵件</label>
                        <input type="email" id="customerEmail" name="email">
                    </div>
                    <div class="form-group">
                        <label for="customerPosition">職稱</label>
                        <input type="text" id="customerPosition" name="position">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerCompany">公司名稱</label>
                        <input type="text" id="customerCompany" name="company">
                    </div>
                    <div class="form-group">
                        <label for="customerLineUserId">LINE User ID</label>
                        <input type="text" id="customerLineUserId" name="line_user_id" placeholder="U1234567890...">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customerAddress">地址</label>
                    <textarea id="customerAddress" name="address" rows="2"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerWebsite">官方網站</label>
                        <input type="url" id="customerWebsite" name="website" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="customerFacebook">Facebook</label>
                        <input type="url" id="customerFacebook" name="facebook_url" placeholder="https://facebook.com/page">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerGoogleMap">Google地圖</label>
                        <input type="url" id="customerGoogleMap" name="google_map_url" placeholder="https://maps.google.com/...">
                    </div>
                    <div class="form-group">
                        <label for="customerContractEndDate">合約到期日</label>
                        <input type="date" id="customerContractEndDate" name="contract_end_date">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customerNotes">備註</label>
                    <textarea id="customerNotes" name="notes" rows="3"></textarea>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">取消</button>
                <button type="submit" form="customerForm" class="btn btn-primary" id="saveBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- LINE設定模態框 -->
    <div id="lineConfigModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>LINE Bot 設定</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="lineConfigStatus" class="config-status">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> 檢查設定中...
                    </div>
                </div>
                
                <form id="lineConfigForm">
                    <div class="form-group">
                        <label for="accessToken">LINE Channel Access Token *</label>
                        <textarea id="accessToken" name="access_token" rows="3" 
                                placeholder="請輸入您的 LINE Channel Access Token" required></textarea>
                        <small>取得方式：前往 LINE Developers Console → 您的 Channel → Messaging API → Channel access token</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="channelSecret">LINE Channel Secret *</label>
                        <input type="text" id="channelSecret" name="channel_secret" 
                               placeholder="請輸入您的 LINE Channel Secret" required>
                        <small>取得方式：前往 LINE Developers Console → 您的 Channel → Basic settings → Channel secret</small>
                    </div>
                </form>
                
                <div class="config-info">
                    <h4>設定說明</h4>
                    <ol>
                        <li>前往 <a href="https://developers.line.biz/console/" target="_blank">LINE Developers Console</a></li>
                        <li>選擇或建立一個 Provider</li>
                        <li>建立新的 Messaging API Channel</li>
                        <li>在 Basic settings 頁面複製 Channel Secret</li>
                        <li>在 Messaging API 頁面複製 Channel Access Token</li>
                        <li>將這兩個值貼到上方欄位中並儲存</li>
                    </ol>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">關閉</button>
                <button type="button" class="btn btn-outline" id="testConnectionBtn">測試連線</button>
                <button type="submit" form="lineConfigForm" class="btn btn-primary">儲存設定</button>
            </div>
        </div>
    </div>

    <!-- 通知訊息 -->
    <div id="notification" class="notification"></div>

    <script src="common-header.js"></script>
    <script src="script.js"></script>
</body>
</html>